{"source":2,"id":1,"revision":38,"name":"ZeroDownTime.Release","createdBy":{"id":"5e6f9e83-e4a6-48fe-a4ea-8e434206e333","displayName":"Jeroen Niesen","uniqueName":"jeroen@niesen.nl","url":"https://app.vssps.visualstudio.com/A0dc025d3-1553-4fc8-a59c-cdbe2f36fab0/_apis/Identities/5e6f9e83-e4a6-48fe-a4ea-8e434206e333","imageUrl":"https://jniesen.visualstudio.com/_api/_common/identityImage?id=5e6f9e83-e4a6-48fe-a4ea-8e434206e333"},"createdOn":"2017-04-07T12:26:57.860Z","modifiedBy":{"id":"5e6f9e83-e4a6-48fe-a4ea-8e434206e333","displayName":"Jeroen Niesen","uniqueName":"jeroen@niesen.nl","url":"https://app.vssps.visualstudio.com/A0dc025d3-1553-4fc8-a59c-cdbe2f36fab0/_apis/Identities/5e6f9e83-e4a6-48fe-a4ea-8e434206e333","imageUrl":"https://jniesen.visualstudio.com/_api/_common/identityImage?id=5e6f9e83-e4a6-48fe-a4ea-8e434206e333"},"modifiedOn":"2017-05-01T11:42:11.247Z","lastRelease":null,"path":"\\","variables":{},"variableGroups":[],"environments":[{"id":1,"name":"Testing","rank":1,"owner":{"id":"5e6f9e83-e4a6-48fe-a4ea-8e434206e333","displayName":"Jeroen Niesen","uniqueName":"jeroen@niesen.nl","url":"https://app.vssps.visualstudio.com/A0dc025d3-1553-4fc8-a59c-cdbe2f36fab0/_apis/Identities/5e6f9e83-e4a6-48fe-a4ea-8e434206e333","imageUrl":"https://jniesen.visualstudio.com/_api/_common/identityImage?id=5e6f9e83-e4a6-48fe-a4ea-8e434206e333"},"variables":{"env-location":{"value":"West Europe"},"env-vnet-name":{"value":"TST-VNET-01"},"env-vnet-resourcegroup":{"value":"TST-RSG-VNET"},"env-availabilityset-name":{"value":"TST-AS-01"},"env-availabilityset-resourcegroup":{"value":"TST-RSG-Compute"},"env-storage-name":{"value":"jnvmstorage"},"env-storage-resourcegroup":{"value":"TST-RSG-Storage"},"env-compute-resourcegroup":{"value":"TST-RSG-Compute"},"env-compute-name":{"value":"$(Release.ReleaseName)"},"env-compute-username":{"value":"jniesen"},"env-compute-password":{"value":null,"isSecret":true},"env-compute-osversion":{"value":"2016-Datacenter"},"env-loadbalancer-name":{"value":"TST-LB-01"},"env-loadbalancer-resourcegroup":{"value":"TST-RSG-Compute"},"env-instances":{"value":"1"}},"preDeployApprovals":{"approvals":[{"rank":1,"isAutomated":true,"isNotificationOn":false,"id":1}]},"deployStep":{"tasks":[],"id":2},"postDeployApprovals":{"approvals":[{"rank":1,"isAutomated":true,"isNotificationOn":false,"id":3}]},"deployPhases":[{"deploymentInput":{"parallelExecution":{"parallelExecutionType":"none"},"skipArtifactsDownload":false,"timeoutInMinutes":0,"queueId":24,"demands":[],"enableAccessToken":false},"rank":1,"phaseType":1,"name":"Run on agent","workflowTasks":[{"taskId":"94a74903-f93f-4075-884f-dc11f34058b4","version":"2.*","name":"Deploy VNET","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":3,"definitionType":"task","inputs":{"ConnectedServiceName":"74c699cf-1c77-4c53-b6ac-242d0a4566e6","action":"Create Or Update Resource Group","resourceGroupName":"$(env-vnet-resourcegroup)","location":"$(env-location)","templateLocation":"Linked artifact","csmFileLink":"","csmParametersFileLink":"","csmFile":"$(System.DefaultWorkingDirectory)/ZeroDownTime-Visual Studio-CI/drop/ARM/VNet/azuredeploy.json","csmParametersFile":"$(System.DefaultWorkingDirectory)/ZeroDownTime-Visual Studio-CI/drop/ARM/VNet/azuredeploy.parameters.json","overrideParameters":"-virtualNetworks_name $(env-vnet-name)","deploymentMode":"Incremental","enableDeploymentPrerequisites":"None","deploymentGroupEndpoint":"","project":"","deploymentGroupName":"","copyAzureVMTags":"true","outputVariable":""}},{"taskId":"584bcff2-3353-4f11-872b-6ba01267a972","version":"1.*","name":"ARM Outputs - VNET","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","inputs":{"ConnectedServiceNameSelector":"ConnectedServiceNameARM","ConnectedServiceNameARM":"74c699cf-1c77-4c53-b6ac-242d0a4566e6","resourceGroupName":"$(env-vnet-resourcegroup)","prefix":"","outputNames":""}},{"taskId":"94a74903-f93f-4075-884f-dc11f34058b4","version":"2.*","name":"Deploy Storage Account","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":3,"definitionType":"task","inputs":{"ConnectedServiceName":"74c699cf-1c77-4c53-b6ac-242d0a4566e6","action":"Create Or Update Resource Group","resourceGroupName":"$(env-storage-resourcegroup)","location":"$(env-location)","templateLocation":"Linked artifact","csmFileLink":"","csmParametersFileLink":"","csmFile":"$(System.DefaultWorkingDirectory)/ZeroDownTime-Visual Studio-CI/drop/ARM/Storage/azuredeploy.json","csmParametersFile":"$(System.DefaultWorkingDirectory)/ZeroDownTime-Visual Studio-CI/drop/ARM/Storage/azuredeploy.parameters.json","overrideParameters":"-StorageAccountName $(env-storage-name)","deploymentMode":"Incremental","enableDeploymentPrerequisites":"None","deploymentGroupEndpoint":"","project":"","deploymentGroupName":"","copyAzureVMTags":"true","outputVariable":""}},{"taskId":"584bcff2-3353-4f11-872b-6ba01267a972","version":"1.*","name":"ARM Outputs - Storage Account","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","inputs":{"ConnectedServiceNameSelector":"ConnectedServiceNameARM","ConnectedServiceNameARM":"74c699cf-1c77-4c53-b6ac-242d0a4566e6","resourceGroupName":"$(env-storage-resourcegroup)","prefix":"","outputNames":""}},{"taskId":"94a74903-f93f-4075-884f-dc11f34058b4","version":"2.*","name":"Deploy AvailabilitySet","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":3,"definitionType":"task","inputs":{"ConnectedServiceName":"74c699cf-1c77-4c53-b6ac-242d0a4566e6","action":"Create Or Update Resource Group","resourceGroupName":"$(env-availabilityset-resourcegroup)","location":"$(env-location)","templateLocation":"Linked artifact","csmFileLink":"","csmParametersFileLink":"","csmFile":"$(System.DefaultWorkingDirectory)/ZeroDownTime-Visual Studio-CI/drop/ARM/AvailabilitySet/azuredeploy.json","csmParametersFile":"$(System.DefaultWorkingDirectory)/ZeroDownTime-Visual Studio-CI/drop/ARM/AvailabilitySet/azuredeploy.parameters.json","overrideParameters":"-availabilitySets_Name $(env-availabilityset-name)","deploymentMode":"Incremental","enableDeploymentPrerequisites":"None","deploymentGroupEndpoint":"","project":"","deploymentGroupName":"","copyAzureVMTags":"true","outputVariable":""}},{"taskId":"584bcff2-3353-4f11-872b-6ba01267a972","version":"1.*","name":"ARM Outputs - Availability Set","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","inputs":{"ConnectedServiceNameSelector":"ConnectedServiceNameARM","ConnectedServiceNameARM":"74c699cf-1c77-4c53-b6ac-242d0a4566e6","resourceGroupName":"$(env-availabilityset-resourcegroup)","prefix":"","outputNames":""}},{"taskId":"94a74903-f93f-4075-884f-dc11f34058b4","version":"2.*","name":"Deploy VMs","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","inputs":{"ConnectedServiceName":"74c699cf-1c77-4c53-b6ac-242d0a4566e6","action":"Create Or Update Resource Group","resourceGroupName":"$(env-compute-resourcegroup)","location":"$(env-location)","templateLocation":"Linked artifact","csmFileLink":"","csmParametersFileLink":"","csmFile":"$(System.DefaultWorkingDirectory)/ZeroDownTime-Visual Studio-CI/drop/ARM/Vms/azuredeploy.json","csmParametersFile":"$(System.DefaultWorkingDirectory)/ZeroDownTime-Visual Studio-CI/drop/ARM/Vms/azuredeploy.parameters.json","overrideParameters":"-WebServerName $(env-compute-name) -WebServerAdminUserName $(env-compute-username) -WebServerAdminPassword (ConvertTo-SecureString -String '$(env-compute-password)' -AsPlainText -Force) -WebServerWindowsOSVersion $(env-compute-osversion) -WebServerStorageAccountName $(created-storage-account-name) -WebServerStorageAccountResourceGroup $(env-storage-resourcegroup) -WebServerVirtualNetworkName $(env-vnet-name) -WebServerVirtualNetworkResourceGroup $(env-vnet-resourcegroup) -WebServerAvailabilitySetName $(env-availabilityset-name) -WebServerInstances $(env-instances)","deploymentMode":"Incremental","enableDeploymentPrerequisites":"None","deploymentGroupEndpoint":"","project":"","deploymentGroupName":"","copyAzureVMTags":"true","outputVariable":""}},{"taskId":"584bcff2-3353-4f11-872b-6ba01267a972","version":"1.*","name":"ARM Outputs - VMs","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","inputs":{"ConnectedServiceNameSelector":"ConnectedServiceNameARM","ConnectedServiceNameARM":"74c699cf-1c77-4c53-b6ac-242d0a4566e6","resourceGroupName":"$(env-compute-resourcegroup)","prefix":"","outputNames":""}},{"taskId":"94a74903-f93f-4075-884f-dc11f34058b4","version":"2.*","name":"Deploy LoadBalancer","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","inputs":{"ConnectedServiceName":"74c699cf-1c77-4c53-b6ac-242d0a4566e6","action":"Create Or Update Resource Group","resourceGroupName":"$(env-loadbalancer-resourcegroup)","location":"$(env-location)","templateLocation":"Linked artifact","csmFileLink":"","csmParametersFileLink":"","csmFile":"$(System.DefaultWorkingDirectory)/ZeroDownTime-Visual Studio-CI/drop/ARM/LoadBalancer/azuredeploy.json","csmParametersFile":"$(System.DefaultWorkingDirectory)/ZeroDownTime-Visual Studio-CI/drop/ARM/LoadBalancer/azuredeploy.parameters.json","overrideParameters":"-loadbalancers_Name $(env-loadbalancer-name) -publicIPAddressType Static -dnsNameforLBIP tstlb01dns","deploymentMode":"Incremental","enableDeploymentPrerequisites":"None","deploymentGroupEndpoint":"","project":"","deploymentGroupName":"","copyAzureVMTags":"true","outputVariable":""}},{"taskId":"584bcff2-3353-4f11-872b-6ba01267a972","version":"1.*","name":"ARM Outputs - LoadBalancer","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","inputs":{"ConnectedServiceNameSelector":"ConnectedServiceNameARM","ConnectedServiceNameARM":"74c699cf-1c77-4c53-b6ac-242d0a4566e6","resourceGroupName":"$(env-loadbalancer-resourcegroup)","prefix":"","outputNames":""}},{"taskId":"72a1931b-effb-4d2e-8fd8-f8472a07cb62","version":"1.*","name":"Configure new VMs for Loadbalancer","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","inputs":{"ConnectedServiceNameSelector":"ConnectedServiceNameARM","ConnectedServiceName":"","ConnectedServiceNameARM":"74c699cf-1c77-4c53-b6ac-242d0a4566e6","ScriptType":"FilePath","ScriptPath":"$(System.DefaultWorkingDirectory)/ZeroDownTime-Visual Studio-CI/drop/Scripts/ConfigureVmsForLoadbalancer.ps1","Inline":"# You can write your azure powershell scripts inline here. \n# You can also pass predefined and custom variables to this script using arguments","ScriptArguments":"-LoadBalancerName $(env-loadbalancer-name) -LoadBalancerResourceGroup $(env-loadbalancer-resourcegroup) -LoadBalancerBackendName $(created-loadbalancer-backend-name) -VmResourceGroup $(env-compute-resourcegroup) -NicPrefix $(created-nic-name-prefix) -Instances $(env-instances)"}},{"taskId":"72a1931b-effb-4d2e-8fd8-f8472a07cb62","version":"1.*","name":"Remove old VMs","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","inputs":{"ConnectedServiceNameSelector":"ConnectedServiceNameARM","ConnectedServiceName":"","ConnectedServiceNameARM":"74c699cf-1c77-4c53-b6ac-242d0a4566e6","ScriptType":"FilePath","ScriptPath":"$(System.DefaultWorkingDirectory)/ZeroDownTime-Visual Studio-CI/drop/Scripts/RemoveOldVms.ps1","Inline":"# You can write your azure powershell scripts inline here. \n# You can also pass predefined and custom variables to this script using arguments","ScriptArguments":"-ResourceGroup $(env-compute-resourcegroup) -VmNamePrefix $(created-vm-name-prefix) -AvailabilitySet $(env-availabilityset-name)"}}]}],"environmentOptions":{"emailNotificationType":"OnlyOnFailure","emailRecipients":"release.environment.owner;release.creator","skipArtifactsDownload":false,"timeoutInMinutes":0,"enableAccessToken":false},"demands":[],"conditions":[{"name":"ReleaseStarted","conditionType":1,"value":""}],"executionPolicy":{"concurrencyCount":0,"queueDepthCount":0},"schedules":[],"retentionPolicy":{"daysToKeep":30,"releasesToKeep":3,"retainBuild":true}}],"artifacts":[{"sourceId":"8edf7f07-4821-4ebf-bb9a-b362fffaf64c:7","type":"Build","alias":"ZeroDownTime-Visual Studio-CI","definitionReference":{"artifactSourceDefinitionUrl":{"id":"https://jniesen.visualstudio.com/_permalink/_build/index?collectionId=0e2e4e2c-a326-46a8-83f7-81624cbad97d&projectId=8edf7f07-4821-4ebf-bb9a-b362fffaf64c&definitionId=7","name":""},"defaultVersionType":{"id":"latestType","name":"Latest"},"definition":{"id":"7","name":"ZeroDownTime-Visual Studio-CI"},"project":{"id":"8edf7f07-4821-4ebf-bb9a-b362fffaf64c","name":"ZeroDownTime"}},"isPrimary":true}],"triggers":[],"releaseNameFormat":"ZD-$(Date:MMddyy)-$(rev:r)","url":"https://jniesen.vsrm.visualstudio.com/8edf7f07-4821-4ebf-bb9a-b362fffaf64c/_apis/Release/definitions/1","_links":{"self":{"href":"https://jniesen.vsrm.visualstudio.com/8edf7f07-4821-4ebf-bb9a-b362fffaf64c/_apis/Release/definitions/1"},"web":{"href":"https://jniesen.visualstudio.com/8edf7f07-4821-4ebf-bb9a-b362fffaf64c/_apps/hub/ms.vss-releaseManagement-web.hub-explorer?definitionId=1"}},"tags":[],"properties":{}}